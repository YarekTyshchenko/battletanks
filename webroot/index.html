<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="stylesheet" href="css/game.css" />
        <script src="js/jquery.min.js"></script>
        <script src='js/socket.io.js'></script>
        <script src="js/underscore.js"></script>
        <script src="js/gameloop.js"></script>
        <script src="js/gamemanager.js"></script>
        <script src="js/gameobject.js"></script>
        <script src="js/tankSprite.js"></script>
        <script src="js/tank.js"></script>
        <script src="js/tankCanvas.js"></script>
        <script src="js/shell.js"></script>
        <script src="js/shellCanvas.js"></script>
        <script src="js/background.js"></script>
    </head>
    <body>
        <canvas id="background" width="500" height="500"></canvas>
        <canvas id="gamearea" width="500" height="500"></canvas>
        <script>
            $(document).ready(function() {
                var canvas = document.getElementById('gamearea');
                var context = canvas.getContext('2d');
                Tank.drawer = TankCanvas;
                Shell.drawer = ShellCanvas;
                GameManager.init(canvas, context);
                Background.init();
                var socket = io.connect(
                    'http://'+window.location.hostname+':9000/'
                );

                socket.on('connect', function () {});
                socket.emit('load');
                socket.on('load', function(data) {
                    // Receive bunch of data and populate map with tanks
                    for (var i in data.objects) {
                        var tank = Object.create(Tank);
                        _.extend(tank, data.objects[i]);
                        GameManager.addObject(tank);
                    };
        
                    gameloop();
                });

                socket.on('createTank', function(data){
                    var tank = Object.create(Tank);
                    _.extend(tank, data.object);
                    GameManager.addObject(tank);
                });

                socket.on('createShell', function(data){
                    var shell = Object.create(Shell);
                    _.extend(shell, data.object);
                    GameManager.addObject(shell);
                });

                socket.on('moveTank', function(data) {
                    GameManager.moveTank(data.object);
                });

                socket.on('updateTank', function(data) {
                    console.log(data.object.hp);
                });
            });
        </script>
    </body>
</html>
